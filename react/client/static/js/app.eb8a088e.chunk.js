(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{231:function(e,t,n){"use strict";n.d(t,"a",(function(){return N}));var r=n(10),a=n.n(r),s=n(4),o=n.n(s),i=n(8),c=n.n(i),u=n(5),l=n.n(u),p=n(6),d=n.n(p),w=n(16),f=n.n(w),g=n(7),h=n.n(g),b=n(21),m=n.n(b),v=n(1),y=n.n(v),x=n(13),O=n(37),j=n(35),_=n(77),k=n(3),S=n(23),E=n(218),P=n(219),D=n(230),T=n(232),C=P.a.plugin(D.a).plugin(T.a),A=n(158);function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var L=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},A,{Router:A.HashRouter}),B=n(223),R=n.n(B);function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function z(e){return Object(E.sha256)(e)}window.React=y.a,window.PouchDB=C,window.session_db=new C("session");var U=function(){var e;return m.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if("web"!==j.a.OS){t.next=2;break}return t.abrupt("return");case 2:return e={},t.next=5,m.a.awrap(Promise.all(["rapyd_home_view"].map((function(t){return m.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,m.a.awrap(_.a.getItem(t));case 2:return n.abrupt("return",e[t]=n.sent);case 3:case"end":return n.stop()}}))}))));case 5:window.localStorage=e;case 6:case"end":return t.stop()}}))}(),N=function(e){function t(e){var n,r;return o()(this,t),n=l()(this,d()(t).call(this,e)),window.renderApp=n.renderApp.bind(f()(n)),n.state={login:"",password:"",url:"",settings_popup:!1,loaded:!1},"web"===j.a.OS&&(n.state.url=(r=window.location.origin+window.location.pathname).substring(0,r.lastIndexOf("/"))+"/"),O.a.addEventListener("change",(function(){return n.setState({width:Math.min(732,Math.max(65*O.a.get("window").width/100,350))})})),n}return h()(t,e),c()(t,[{key:"clickEvent",value:function(e){e.preventDefault(),13===e.keyCode&&this.loginApp({})}},{key:"componentDidMount",value:function(){var e,t;return m.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return e=window.session_db.get("session"),n.next=3,m.a.awrap(_.a.getItem("rapyd_server_url"));case 3:if(n.t0=n.sent,n.t0){n.next=6;break}n.t0=this.state.url;case 6:return t=n.t0,this.state.url=t,n.prev=8,n.t1=this,n.next=12,m.a.awrap(e);case 12:return n.t2=n.sent,n.abrupt("return",n.t1.loginApp.call(n.t1,n.t2));case 16:n.prev=16,n.t3=n.catch(8),console.log(n.t3);case 19:return"web"===j.a.OS&&document.body.addEventListener("keyup",this.clickEvent.bind(this)),n.abrupt("return",this.setState({url:t,loaded:!0}));case 21:case"end":return n.stop()}}),null,this,[[8,16]])}},{key:"updateSession",value:function(e){var t;return m.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return e._id||(e._id="session"),t={},n.prev=2,n.next=5,m.a.awrap(window.session_db.get("session"));case 5:t=n.sent,n.next=10;break;case 8:n.prev=8,n.t0=n.catch(2);case 10:return t._rev&&(e._rev=t._rev),n.abrupt("return",window.session_db.put(e));case 12:case"end":return n.stop()}}),null,null,[[2,8]])}},{key:"loginApp",value:function(e){var t,n,r,a,s,o,i,c,u;return m.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,m.a.awrap(U);case 2:if(l.t0=e.login,l.t0){l.next=7;break}return l.next=6,m.a.awrap(z(this.state.login));case 6:l.t0=l.sent;case 7:if(t=l.t0,l.t1=e.password,l.t1){l.next=13;break}return l.next=12,m.a.awrap(z(t+this.state.password));case 12:l.t1=l.sent;case 13:return n=l.t1,e.login=t,e.password=n,r="/api/login?login="+t+"&password="+n,e&&e.client_js_time&&(r+="&client_js_time="+e.client_js_time),l.prev=17,l.next=20,m.a.awrap(fetch(this.state.url+r));case 20:return a=l.sent,l.next=23,m.a.awrap(a.json());case 23:if("denied"!==(s=l.sent).status){l.next=26;break}return l.abrupt("return",alert("Username/Password wrong, relogin")||this.setState({loaded:!0,ClientApp:null}));case 26:"success"!==s.status?alert("Network Error"):e=F({},e,{},s),l.next=33;break;case 29:l.prev=29,l.t2=l.catch(17),console.log(l.t2),alert("Network Error");case 33:if(e.client_js){l.next=35;break}return l.abrupt("return");case 35:if(o={},"web"===j.a.OS){l.next=40;break}(new(Function.prototype.bind.apply(Function,[null,"export_object",e.client_js])))(o),l.next=49;break;case 40:return i=new Blob([e.client_js],{type:"text/javascript"}),window.export_object=o,c=document.createElement("script"),u=new Promise((function(e,t){return(c.onload=e)&&(c.onerror=t)})),c.src=URL.createObjectURL(i),document.head.appendChild(c),l.next=48,m.a.awrap(u);case 48:delete window.export_object;case 49:return o.tools.client={components:F({},S,{},k,{},L),Native:k,MaterialComponents:S,ReactRouter:L,XMLParser:R.a},l.next=52,m.a.awrap(o.tools.init_client());case 52:return l.abrupt("return",this.updateSession(e));case 53:case"end":return l.stop()}}),null,this,[[17,29]])}},{key:"renderApp",value:function(e){return console.log(e),this.setState({ClientApp:y.a.createElement(e,null)})}},{key:"render",value:function(){var e=this;if(this.state.ClientApp)return this.state.ClientApp;if(!this.state.loaded)return y.a.createElement(x.a,null);var t=this.state.width||Math.min(732,Math.max(65*O.a.get("window").width/100,350));return y.a.createElement(x.a,{style:{alignItems:"center",marginTop:34}},y.a.createElement(S.Heading,{type:3,text:"Welcome"}),y.a.createElement(S.TextField,{containerStyle:{marginTop:20},style:{fontSize:17,marginBottom:10,width:t},label:"Username",leadingIcon:y.a.createElement(S.Icon,{name:"account-circle",size:24,color:"#6e6e6e"}),type:"flat",value:this.state.login,onChangeText:function(t){return e.setState({login:t})}}),y.a.createElement(S.TextField,{secureTextEntry:!0,password:"web"!==j.a.OS||void 0,containerStyle:{marginTop:10},style:{fontSize:17,marginBottom:10,width:t},label:"Password",leadingIcon:y.a.createElement(S.Icon,{name:"lock",size:24,color:"#6e6e6e"}),type:"flat",value:this.state.password,onChangeText:function(t){return e.setState({password:t})}}),y.a.createElement(x.a,{style:{marginTop:10,flexDirection:"row"}},y.a.createElement(S.Button,{text:"Login",onPress:function(){return e.loginApp({})}}),y.a.createElement(S.Button,{text:"Settings",style:{marginLeft:t-150},onPress:function(){return e.setState({settings_popup:!0})}})),y.a.createElement(S.Dialog,{visible:this.state.settings_popup,onTouchOutside:function(){return e.setState({settings_popup:!1})},title:"Server URL",actionItems:[{text:"Cancel",onPress:function(){return e.setState({settings_popup:!1})}},{text:"OK",onPress:function(){return _.a.setItem("rapyd_server_url",e.state.url)&&e.setState({settings_popup:!1})}}]},y.a.createElement(S.TextField,{type:"flat",value:this.state.url,onChangeText:function(t){return e.setState({url:t})},containerStyle:{marginTop:-30,marginBottom:10},style:{fontSize:17,marginBottom:10,width:250}})))}}]),t}(y.a.Component)},233:function(e,t,n){n(234),e.exports=n(580)},234:function(e,t){"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("/expo-service-worker.js",{scope:"/"}).then((function(e){})).catch((function(e){console.info("Failed to register service-worker",e)}))}))}},[[233,1,2]]]);
//# sourceMappingURL=app.eb8a088e.chunk.js.map